# 2 Program Structure

### 2.1 åç§°

Go ä¸­çš„å‡½æ•°åã€å˜é‡åã€å¸¸é‡åã€ç±»å‹åã€è¯­å¥æ ‡ç­¾ã€åŒ…åéƒ½éµå¾ªä¸€ä¸ªç®€å•çš„è§„åˆ™ï¼šä»¥ä¸€ä¸ªå­—ç¬¦æˆ–ä¸‹åˆ’çº¿ä»¥åŠå¯èƒ½çš„ä»»æ„é•¿åº¦çš„å­—ç¬¦ã€æ•°å­—åŠä¸‹åˆ’çº¿ï¼Œå¹¶åŒºåˆ†å¤§å°å†™ã€‚

ä¿ç•™å…³é”®å­—ï¼š

* **fallthrough:** switch çš„ case è¯­å¥ä¸­ å¯ä»¥ä½¿ç”¨ fallthrough å¼ºåˆ¶æ‰§è¡Œåé¢çš„ case ä»£ç ï¼Œfallthrough ä¸ä¼šåˆ¤æ–­ä¸‹ä¸€æ¡ case çš„ expr ç»“æœæ˜¯å¦ä¸º trueã€‚

å¯ä»¥ç”¨äºå˜é‡å®šä¹‰çš„é¢„å®šä¹‰å…³é”®å­—ï¼ˆğŸ’¡ è°¨æ…ä½¿ç”¨ï¼Œä¼šè¦†ç›–åŸæœ‰çš„ç”¨æ³•ï¼‰ï¼š

* å¸¸é‡
  * **iota**
  * **nil**
* ç±»å‹
  * **uintptr:** uintptr is an integer type that is large enough to hold the bit pattern of any pointer.
  *   **complex128, complex64:** å¤æ•°ï¼Œå®éƒ¨è™šéƒ¨å‡ä¸º float(64,32) ç±»å‹

      ```go
      var c complex64 = complex(1, 2) // 1+2i
      real(c),imag(c) // 1,2
      ```
  * **rune:** int32ï¼Œunicodeç ç‚¹
* å‡½æ•°
  * **cap:** array, slice, channel å ç”¨çš„ç©ºé—´
  *   **copy:** å°†æºåˆ‡ç‰‡å…ƒç´ å¤åˆ¶åˆ°ç›®çš„åˆ‡ç‰‡

      ```go
       s1 := []int{1, 2, 3}
       s2 := []int{4, 5, 6, 7, 8}
       copy(s1, s2)
       s1[0] = 1
       fmt.Println(s1) // [1 5 6]
       fmt.Println(s2) // [4 5 6 7 8]
      ```
  * **recover:** å°† panic çš„ goroutine æ¢å¤è¿è¡Œ\
    recover ä»…åœ¨å»¶è¿Ÿå‡½æ•° defer ä¸­æœ‰æ•ˆï¼Œåœ¨æ­£å¸¸çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè°ƒç”¨ recover ä¼šè¿”å› nil å¹¶ä¸”æ²¡æœ‰å…¶ä»–ä»»ä½•æ•ˆæœï¼Œå¦‚æœå½“å‰çš„ goroutine é™·å…¥ææ…Œï¼Œè°ƒç”¨ recover å¯ä»¥æ•è·åˆ° panic çš„è¾“å…¥å€¼ï¼Œå¹¶ä¸”æ¢å¤æ­£å¸¸çš„æ‰§è¡Œã€‚\
    é€šå¸¸æ¥è¯´ï¼Œä¸åº”è¯¥å¯¹è¿›å…¥ panic å®•æœºçš„ç¨‹åºåšä»»ä½•å¤„ç†ï¼Œä½†æœ‰æ—¶ï¼Œéœ€è¦æˆ‘ä»¬å¯ä»¥ä»å®•æœºä¸­æ¢å¤ï¼Œè‡³å°‘æˆ‘ä»¬å¯ä»¥åœ¨ç¨‹åºå´©æºƒå‰ï¼Œåšä¸€äº›æ“ä½œï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå½“ web æœåŠ¡å™¨é‡åˆ°ä¸å¯é¢„æ–™çš„ä¸¥é‡é—®é¢˜æ—¶ï¼Œåœ¨å´©æºƒå‰åº”è¯¥å°†æ‰€æœ‰çš„è¿æ¥å…³é—­ï¼Œå¦‚æœä¸åšä»»ä½•å¤„ç†ï¼Œä¼šä½¿å¾—å®¢æˆ·ç«¯ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ï¼Œå¦‚æœ web æœåŠ¡å™¨è¿˜åœ¨å¼€å‘é˜¶æ®µï¼ŒæœåŠ¡å™¨ç”šè‡³å¯ä»¥å°†å¼‚å¸¸ä¿¡æ¯åé¦ˆåˆ°å®¢æˆ·ç«¯ï¼Œå¸®åŠ©è°ƒè¯•ã€‚\
    defer func() { err := recover(); ... }() // è·å–panicä¼ é€’çš„ä¸Šä¸‹æ–‡å¹¶æ‰“å°\
    [http://c.biancheng.net/view/64.html](http://c.biancheng.net/view/64.html)

Goæ²¡æœ‰é™åˆ¶åç§°çš„é•¿åº¦ï¼Œä½†ä½œç”¨åŸŸå°çš„åç§°å»ºè®®ç®€çŸ­ï¼Œä½œç”¨åŸŸå¤§çš„åç§°å»ºè®®ç”¨é•¿ä¸”å…·æœ‰æ„ä¹‰çš„åç§°ã€‚

ç›¸è¾ƒäºåœ¨å•è¯ä¹‹é—´ä½¿ç”¨ä¸‹åˆ’çº¿ï¼ŒGoæ›´å€¾å‘äºå•è¯é—´é¦–å­—æ¯å¤§å†™çš„é£æ ¼ã€‚

### 2.2 å£°æ˜

...

### 2.3 å˜é‡

#### 2.3.2 æŒ‡é’ˆ

å€¼ä¸ä¸€å®šéƒ½æœ‰åœ°å€ï¼Œä½†å˜é‡éƒ½æœ‰åœ°å€ã€‚ä½¿ç”¨æŒ‡é’ˆå¯ä»¥åœ¨ä¸çŸ¥é“å˜é‡çš„åç§°çš„æƒ…å†µä¸‹å¯¹å˜é‡è¿›è¡Œé—´æ¥çš„è¯»å†™ã€‚

æŒ‡é’ˆå¯¹äº flag åŒ…å¾ˆå…³é”®ï¼Œæ ‡è¯†å‚æ•°çš„å€¼éœ€è¦é€šè¿‡æŒ‡é’ˆæ¥è®¿é—®ã€‚**éœ€è¦æ³¨æ„æ ‡è¯†å‚æ•°éœ€è¦å†™åˆ°éæ ‡è¯†å‚æ•°å‰ã€‚**

ğŸ’¡ æ ‡å¿—å‚æ•°å³ç”¨ flag æ˜¾å¼å£°æ˜çš„å‚æ•°

```go
n := flag.Int("i", 100, "int arg")
flag.Parse()
args := flag.Args()
fmt.Println(args)
fmt.Println(*n)
fmt.Println("---flag.Args()---")
for _, arg := range args {
    fmt.Printf("%T, %v\n", arg, arg)
}
fmt.Println("---os.Args---")
for _, arg := range os.Args {
    fmt.Printf("%T, %v\n", arg, arg)
}
```

å‘½ä»¤åŠè¾“å‡ºï¼š

```
>go run . -i 10 "a" "b"
[a b]
10
---flag.Args()---
string, a
string, b
---os.Args---
string, C:\Users\***\AppData\Local\Temp\go-build******\b001\exe\**.exe
string, -i
string, 10
string, a
string, b
```

ğŸ’¡ å¦‚æœåœ¨å‘½ä»¤è¡Œä¸­æŠŠæ ‡å¿—å‚æ•°å†™åˆ°éæ ‡è¯†å‚æ•°åï¼Œå°†æ— æ³•è¢«æ­£å¸¸è§£æï¼š

```
> go run . "a" "b" -i 10
[a b -i 10]
100
---flag.Args()---
string, a
string, b
string, -i
string, 10
---os.Args---
string, C:\Users\acer\AppData\Local\Temp\go-build1468167120\b001\exe\main.exe
string, a
string, b
string, -i
string, 10

```

#### 2.3.3 newå‡½æ•°

new(T) åˆ›å»ºä¸€ä¸ªæœªå‘½åçš„Tç±»å‹å˜é‡ï¼Œåˆå§‹åŒ– T ç±»å‹çš„é›¶å€¼ï¼Œå¹¶è¿”å›åœ°å€ã€‚

new åœ¨åˆ›å»ºä¸åŒ…å«ä¿¡æ¯çš„ç»“æ„æ—¶ï¼Œå¯èƒ½è¿”å›ç›¸åŒçš„åœ°å€

```go
a := new(struct{})
b := new(struct{})
fmt.Printf("%p\n", a) // 0x1194b40
fmt.Printf("%p\n", b) // 0x1194b40
fmt.Println(a == b) // true
fmt.Println("=======")
c := new([0]int)
d := new([0]int)
fmt.Printf("%p\n", c) // 0x1194b40
fmt.Printf("%p\n", d) // 0x1194b40
fmt.Println(c == d) // true
```

#### 2.3.4 å˜é‡çš„ç”Ÿå‘½å‘¨æœŸ

åŒ…çº§åˆ«å˜é‡çš„ç”Ÿå‘½å‘¨æœŸæ˜¯æ•´ä¸ªç¨‹åºçš„æ‰§è¡Œæ—¶é—´ã€‚ç›¸åï¼Œå±€éƒ¨å˜é‡æœ‰ä¸ªä¸€åŠ¨æ€çš„ç”Ÿå‘½å‘¨æœŸï¼šæ¯æ¬¡æ‰§è¡Œå£°æ˜è¯­å¥æ—¶åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä½“ï¼Œç›´åˆ°å…¶å˜å¾—ä¸å¯è®¿é—®ï¼Œä¸å¯è®¿é—®åå®ƒçš„å­˜å‚¨ç©ºé—´å¯èƒ½ä¼šè¢«å›æ”¶ã€‚

### 2.4 èµ‹å€¼

...

### 2.5 ç±»å‹å£°æ˜

```go
type name underlyingType
```

type å£°æ˜å®šä¹‰ä¸€ä¸ªæ–°çš„å‘½åç±»å‹ï¼Œå®ƒå’ŒæŸä¸ªå·²æœ‰ç±»å‹ä½¿ç”¨åŒæ ·çš„åº•å±‚ç±»å‹ã€‚**å¯¹åŒä¸€åº•å±‚ç±»å‹ï¼Œå‘½åç±»å‹æä¾›äº†ä¸€ç§åŒºåˆ†ä¸åŒçš„ä»¥åŠå¯èƒ½ä¸å…¼å®¹çš„ä½¿ç”¨ç›¸åŒåº•å±‚ç±»å‹çš„æ‰‹æ®µï¼Œè¿™æ ·å¯ä»¥é¿å…æ— æ„é—´çš„ç±»å‹æ··æ·†ã€‚**

å¯¹äºæ¯ä¸ªç±»å‹ Tï¼Œéƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ç±»å‹è½¬æ¢æ“ä½œ T(x) å°†å€¼è½¬æ¢ä¸ºç±»å‹ Tã€‚å¦‚æœä¸¤ä¸ªç±»å‹å…·æœ‰ç›¸åŒçš„åº•å±‚ç±»å‹ï¼Œæˆ–è€…äºŒè€…éƒ½æ˜¯æŒ‡å‘ç›¸åŒåº•å±‚ç±»å‹å˜é‡çš„æœªå‘½åæŒ‡é’ˆç±»å‹ï¼Œé‚£ä¹ˆä¸¤è€…é—´å¯ä»¥ç›¸äº’è½¬æ¢ã€‚ï¼ˆğŸ’¡ éæŒ‡é’ˆç±»å‹å˜é‡æœ¬èº«åŠå…¶æŒ‡é’ˆï¼‰

ğŸ’¡ ç±»å‹è½¬æ¢å’Œå…¶æŒ‡é’ˆç±»å‹è½¬æ¢ï¼š

<pre class="language-go"><code class="lang-go">type Balance int
type Amount int
var b Balance = 100
fmt.Println(Amount(b)) // 100
var amount Amount = 100
var addressA = &#x26;amount
<strong>var addressB = (*Balance)(addressA)
</strong>fmt.Println(*addressB) // 100
</code></pre>

å‘½åç±»å‹çš„åº•å±‚ç±»å‹å†³å®šäº†å®ƒçš„ç»“æ„å’Œä½¿ç”¨æ–¹å¼ï¼Œä»¥åŠå®ƒæ”¯æŒçš„å†…éƒ¨æ“ä½œé›†åˆï¼Œè¿™äº›å†…éƒ¨æ“ä½œä¸ç›´æ¥ä½¿ç”¨åº•å±‚ç±»å‹çš„æƒ…å†µç›¸åŒã€‚é€šè¿‡ == å’Œ < ä¹‹ç±»çš„æ¯”è¾ƒæ“ä½œç¬¦ï¼Œå‘½åç±»å‹å¯ä»¥ä¸å…¶ç›¸åŒç±»å‹çš„å€¼æˆ–è€…åº•å±‚ç±»å‹ç›¸åŒçš„**æœªå‘½å**çš„å€¼ç›¸æ¯”è¾ƒã€‚ä½†æ˜¯ä¸åŒå‘½åç±»å‹çš„å€¼ä¸èƒ½ç›´æ¥æ¯”è¾ƒï¼š

```go
var f1 tF1 = 0.0
var f float32 = 0.0
fmt.Println(f1 == 0.0) // true
fmt.Println(f == f1) // mismatched types float32 and tF1
fmt.Println(f == float32(f1)) // true
```

### 2.6 åŒ…å’Œæ–‡ä»¶

#### 2.6.2 åŒ…åˆå§‹åŒ–

åŒ…åˆå§‹åŒ–ä»åˆå§‹åŒ–åŒ…çº§åˆ«å˜é‡å¼€å§‹ï¼Œåˆå§‹åŒ–æŒ‰ç…§å˜é‡å£°æ˜çš„é¡ºåºè¿›è¡Œï¼Œæœ‰ä¾èµ–å…³ç³»æ—¶ä¸ºä¾‹å¤–ï¼š

```go
var a = b + c // æœ€ååˆå§‹åŒ– a
var b = f() // å…¶æ¬¡é€šè¿‡è°ƒç”¨ f åˆå§‹åŒ– b
var c = 1 // é¦–å…ˆåˆå§‹åŒ– c
func f() int { return c + 1 }
```

å¦‚æœåŒ…æœ‰å¤šä¸ª .go æ–‡ä»¶ï¼Œgo å·¥å…·åœ¨å°†åŒ…ä¸­çš„æ–‡ä»¶äº¤ç»™ç¼–è¯‘å™¨å‰ä¼šå°†æ–‡ä»¶æŒ‰åå­—æ’åºï¼Œç¼–è¯‘å™¨å†å°†æ–‡ä»¶æŒ‰æ¥æ”¶åˆ°çš„é¡ºåºè¿›è¡Œåˆå§‹åŒ–ã€‚

ä»»æ„æ–‡ä»¶å¯ä»¥åŒ…å«ä»»æ„æ•°é‡çš„ init å‡½æ•°ï¼ŒğŸ’¡ init å‡½æ•°ä¸€èˆ¬ç”¨äºå¤æ‚æ•°æ®çš„åˆå§‹åŒ–ã€‚

```go
func init() { ... }
```

init å‡½æ•°ä¸èƒ½è¢«è°ƒç”¨ä¸å¼•ç”¨ï¼Œä½†é™¤æ­¤ä¹‹å¤–å’Œæ™®é€šå‡½æ•°æ²¡æœ‰å…¶ä»–ä¸åŒã€‚åœ¨æ¯ä¸ªæ–‡ä»¶ä¸­ï¼Œinit å‡½æ•°æ ¹æ®å£°æ˜çš„é¡ºåºè‡ªåŠ¨è¢«æ‰§è¡Œã€‚

æŒ‰ç…§ç¨‹åºä¸­å¯¼å…¥çš„é¡ºåºï¼Œæ¯æ¬¡åˆå§‹åŒ–ä¸€ä¸ªåŒ…ï¼Œä¾èµ–ä¼˜å…ˆåˆå§‹åŒ–ã€‚æ‰€ä»¥åŒ… p å¯¼å…¥åŒ… q æ—¶ï¼Œq è¢«å®Œæ•´åˆå§‹åŒ–åå†å¼€å§‹ p çš„åˆå§‹åŒ–ã€‚å› æ­¤ï¼Œåœ¨ main å‡½æ•°æ‰§è¡Œä¹‹å‰ï¼Œæ‰€æœ‰çš„åŒ…éƒ½è¢«åˆå§‹åŒ–å®Œæ¯•äº†ã€‚

### 2.7 ä½œç”¨åŸŸ

å£°æ˜å°†åå­—å’Œç¨‹åºå®ä½“å…³è”èµ·æ¥ï¼Œå¦‚ä¸€ä¸ªå‡½æ•°æˆ–ä¸€ä¸ªå˜é‡ã€‚å£°æ˜çš„ä½œç”¨åŸŸæ˜¯æŒ‡ç”¨åˆ°å£°æ˜æ—¶å£°æ˜åå­—çš„æºä»£ç ç‰‡æ®µã€‚

ä½œç”¨åŸŸå’Œç”Ÿå‘½å‘¨æœŸæ˜¯ä¸åŒçš„æ¦‚å¿µï¼Œå£°æ˜çš„ä½œç”¨åŸŸæ˜¯ç¨‹åºæ–‡æœ¬ä¸­å‡ºç°çš„åŒºåŸŸï¼Œæ˜¯ç¼–è¯‘æ—¶å±æ€§ã€‚å˜é‡çš„ç”Ÿå‘½å‘¨æœŸæ˜¯å˜é‡åœ¨ç¨‹åºæ‰§è¡ŒæœŸé—´èƒ½è¢«ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†æ‰€å¼•ç”¨çš„èµ·æ­¢æ—¶é—´ï¼Œæ˜¯è¿è¡Œæ—¶å±æ€§ã€‚ğŸ’¡ ä½œç”¨åŸŸæ˜¯ä»ä»£ç æ®µçš„è§’åº¦ï¼Œé™åˆ¶è®¿é—®èŒƒå›´ï¼Œç”Ÿå‘½å‘¨æœŸæ˜¯æŒ‡å˜é‡çš„åˆ†é…å’Œå›æ”¶çš„è¿‡ç¨‹ã€‚

è¯­æ³•å—ï¼ˆsyntactic blockï¼‰æ˜¯ç”±å¤§æ‹¬å·å›´èµ·æ¥çš„ä¸€ä¸ªè¯­å¥åºåˆ—ã€‚æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªæ¦‚å¿µæ‰©å±•åˆ°æ²¡æœ‰æ˜¾å¼è¢«å¤§æ‹¬å·åŒ…å›´çš„ä¸€ç»„å£°æ˜é‡Œé¢ï¼Œç§°ä¸ºè¯æ³•å—ï¼ˆlexical blockï¼‰ã€‚åŒ…å«äº†å…¨éƒ¨ä»£ç çš„è¯æ³•å—å«åšå…¨å±€å—ï¼ˆuniverse blockï¼‰ã€‚æ¯ä¸€ä¸ªæ–‡ä»¶ï¼Œæ¯ä¸€ä¸ª for, if å’Œ switch è¯­å¥ï¼Œä»¥åŠ switch å’Œ select è¯­å¥ä¸­çš„æ¯ä¸€ä¸ªæ¡ä»¶ï¼Œéƒ½æ˜¯å†™åœ¨ä¸€ä¸ªè¯æ³•å—é‡Œçš„ã€‚è¯æ³•å—åŒ…å«è¯­æ³•å—ã€‚

ä¸€ä¸ªå£°æ˜çš„è¯æ³•å—å†³å®šå£°æ˜çš„ä½œç”¨åŸŸå¤§å°ã€‚å†…ç½®çš„ç±»å‹ã€å‡½æ•°æˆ–å¸¸é‡åœ¨å…¨å±€å—ä¸­å£°æ˜ä¸”å¯¹äºæ•´ä¸ªç¨‹åºå¯è§ã€‚åŒ…çº§åˆ«çš„å£°æ˜å¯ä»¥è¢«åŒä¸€ä¸ªåŒ…é‡Œçš„ä»»ä½•æ–‡ä»¶å¼•ç”¨ã€‚å¯¼å…¥çš„åŒ…çš„å£°æ˜æ˜¯æ–‡ä»¶çº§åˆ«çš„ï¼Œä»…å¯åœ¨å½“å‰æ–‡ä»¶å¼•ç”¨ã€‚ğŸ’¡ å¯¼å…¥ä¸€ä¸ªåŒ…å¯ä»¥çœ‹æˆæ˜¯è¿›è¡Œäº†ä¸€æ¬¡å£°æ˜ï¼š

```go
import "fmt" // fmt å³æ˜¯ä¸€ä¸ªå£°æ˜
```

ä¸æ˜¯æ‰€æœ‰çš„è¯æ³•å—éƒ½å¯¹åº”äºæ˜¾å¼å¤§æ‹¬å·åŒ…å›´çš„è¯­å¥åºåˆ—ï¼Œæœ‰ä¸€äº›è¯æ³•å—æ˜¯éšå¼çš„ã€‚å¦‚ for å¾ªç¯ä¸­çš„è¿­ä»£å˜é‡ i æ‰€åœ¨è¡Œå³ä¸ºä¸€ä¸ªéšå¼å—ï¼Œi çš„ä½œç”¨åŸŸåŒ…æ‹¬æ¡ä»¶ã€åç½®è¯­å¥ï¼ˆi++ï¼‰ï¼Œä»¥åŠ for è¯­å¥ä½“æœ¬èº«ã€‚

çŸ­å˜é‡å£°æ˜éœ€è¦ç•™æ„ä½œç”¨åŸŸï¼š

```go
var cwd string
func init() {
    cwd, err := os.Getwd() // unused: cwd
    if err != nil {
        log.Fatal(err)
    }
}
```

cwd åœ¨å‡½æ•°ä¸­è¢«å£°æ˜ä¸ºäº†ä¸€ä¸ªæ–°çš„å±€éƒ¨å˜é‡ï¼ˆğŸ’¡ä¸åœ¨åŒä¸€ä½œç”¨åŸŸçš„çŸ­å˜é‡å£°æ˜ä¼šåˆ›å»ºæ–°å˜é‡ï¼‰

```go
var cwd string
func init() {
    var err error
    cwd, err = os.Getwd()
    if err != nil {
        log.Fatal(err)
    }
}
```

å°† err æå‰å£°æ˜åˆ™ä¸ä¼šå‡ºç°é—®é¢˜ã€‚
